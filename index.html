<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments">
        <li class="comment">
          <div class="comment-header">
            <div>Глеб Фокин</div>
            <div>12.02.22 12:18</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Это будет первый комментарий на этой странице
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">3</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>
        <li class="comment">
          <div class="comment-header">
            <div>Варвара Н.</div>
            <div>13.02.22 19:22</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Мне нравится как оформлена эта страница! ❤
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">75</span>
              <button class="like-button -active-like"></button>
            </div>
          </div>
        </li>
      </ul>

      <div class="delete-form">
        <button class="delete-form-button">Удалить последний комментарий</button>
      </div>


      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button">Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    "use strict";

  const ulElement = document.querySelector('ul[class="comments"]');
  const buttonElement = document.querySelector('button[class="add-form-button"]');
  const nameElement = document.querySelector('input[class="add-form-name"]');
  const textElement = document.querySelector('textarea[class="add-form-text"]');
  const currentTime = new Date();
  const commentTime = `${currentTime.toLocaleDateString('ru-Ru', { day: "2-digit", month: "2-digit", year: "2-digit" })} ${currentTime.toLocaleTimeString('ru-Ru', { hour: "2-digit", minute: "2-digit" })}`;

  buttonElement.className = 'error-add-form-button'; // сбрасываю стиль кнопки "Написать" на серый, чтобы было понятно,
  // что без заполнения полей Имя и Комментарий отправить форму нельзя


  // валидация того, пользователь начинает печать и в поле имя и в поле текст, 
  // после чего вызывается функция, которая перекрашивает кнопку "Написать" в зеленый цвет
  let nameElementCheck = false;
  let textElementCheck = false;

  function handleInputs() {
    if (nameElementCheck && textElementCheck) {
      buttonElement.className = 'add-form-button';
    }
  }

  nameElement.addEventListener("input", () => {
    nameElementCheck = true;
    handleInputs();
  });

  textElement.addEventListener("input", () => {
    textElementCheck = true;
    handleInputs();
  });



  // валидация событий нажата либо кнопка "Написать", либо "Enter", и далее вызываем функцию: 
  // добавить элемент Li в последним в Ul, если имя или текст незаполнены, но кнопка "Написать" или "Enter" нажата,
  // то элемент не добавлять и кнопку "Написать" покрасить в серый цвет


  let buttonCheck = false;
  let enterCheck = false;

  function handleButtons() {

    if (buttonCheck || enterCheck) {

      if (nameElement.value === '' || textElement.value === '') {
        buttonElement.className = 'error-add-form-button';
        return;
      }

      ulElement.innerHTML += ` <li class="comment">
          <div class="comment-header">
            <div>${nameElement.value}</div>
            <div>${commentTime}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              ${textElement.value}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">0</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>` ;

      nameElement.value = '';
      textElement.value = '';
      buttonElement.className = 'error-add-form-button';
      nameElementCheck = false;
      textElementCheck = false;

    }

  }

  buttonElement.addEventListener("click", () => {
    buttonCheck = true;
    handleButtons();
  });

  document.addEventListener("keyup", (event) => {
    if (event.key === 'Enter') {
      enterCheck = true;
      handleButtons();
    }
  });


  // функционал удаления последнего комментария
  let buttonDelete = document.querySelector('button[class="delete-form-button"]');
  buttonDelete.addEventListener("click", () => {
    let lis = document.querySelectorAll('.comment');  // создаем коллекцию/псевдомассив из элементов с классом '.comment'
    let liDelete = lis[lis.length - 1];  // определяем элемент для удаления по индексу последнего в коллекции
    liDelete.parentNode.removeChild(liDelete); // вызываем метод удаления потомка коллекции - элемента для удаления
    });


  </script>
</html>
